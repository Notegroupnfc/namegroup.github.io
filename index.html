<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>ƒêang chuy·ªÉn h∆∞·ªõng...</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin-top: 60px;
    }
  </style>
</head>
<body>
  <h2>üì° ƒêang x·ª≠ l√Ω NFC...</h2>
  <p id="message">Vui l√≤ng ch·ªù...</p>

  <script>
    async function handleNFC() {
      const params = new URLSearchParams(window.location.search);
      const id = params.get("id");
      const source = params.get("source") || "web";

      if (!id) {
        document.getElementById("message").innerText = "‚ùå Kh√¥ng c√≥ ID NFC";
        return;
      }

      // Thay YOUR_WEB_APP_URL b·∫±ng URL Web App b·∫°n deploy
      const API = "AKfycbyfHMkSttksbctIb71APA9SS4SWe9fasZRN6eSUN6920B81xVo5tNxE1jK7IAeaDjdh0w"
        + "?id=" + encodeURIComponent(id)
        + "&source=" + encodeURIComponent(source)
        + "&ua=" + encodeURIComponent(navigator.userAgent);

      try {
        document.getElementById("message").innerText = "üîó G·ª≠i y√™u c·∫ßu t·ªõi server...";
        const res = await fetch(API);
        const data = await res.json();

        if (data.LINKS) {
          document.getElementById("message").innerText =
            `üîÄ Chuy·ªÉn t·ªõi ${data.LINKS}`;

          // Redirect sau 1 gi√¢y
          setTimeout(() => {
            window.location.href = data.LINKS;
          }, 800);
        } else {
          document.getElementById("message").innerText =
            "‚ö†Ô∏è Kh√¥ng t√¨m th·∫•y ID: " + id;
        }
      } catch (err) {
        document.getElementById("message").innerText =
          "‚ùå L·ªói khi g·ªçi API";
        console.error(err);
      }
    }

    handleNFC();
  </script>
</body>
</html>
