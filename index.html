<script>
const API_URL = "https://script.google.com/macros/s/AKfycbyGCbIJX6nEcqEcZTcN7hPg3MihjrfS9Q13U7Sv-G3ktp4uc0gIWHjcUpn8NLDz9Zvuuw/exec";

const params = new URLSearchParams(window.location.search);
const id = params.get("id");

const statusEl = document.getElementById("status");
const idTextEl = document.getElementById("idText");

if (!id) {
  statusEl.textContent = "âŒ KhÃ´ng cÃ³ ID NFC";
  statusEl.className = "err";
} else {
  idTextEl.textContent = "ID: " + id;

  fetch(API_URL + "?id=" + encodeURIComponent(id))
    .then(res => res.json())
    .then(data => {

      if (data.status === "OK") {
        statusEl.innerHTML =
          "âœ… <b>" + data.ten_toa_nha + "</b><br>" +
          "ğŸ“ " + data.quan + " â€“ Táº§ng " + data.tang;

        statusEl.className = "ok";

        // â³ Redirect sau 2 giÃ¢y
        if (data.links) {
          setTimeout(() => {
            window.location.href = data.links;
          }, 2000);
        }

      } else if (data.status === "DUPLICATE_BLOCKED") {
        statusEl.textContent = "â³ ÄÃ£ quÃ©t gáº§n Ä‘Ã¢y, vui lÃ²ng chá»";
        statusEl.className = "warn";

      } else if (data.status === "ID_NOT_FOUND") {
        statusEl.textContent = "âŒ ID khÃ´ng tá»“n táº¡i";
        statusEl.className = "err";

      } else {
        statusEl.textContent = "âŒ Lá»—i: " + data.status;
        statusEl.className = "err";
      }
    })
    .catch(() => {
      statusEl.textContent = "âŒ Lá»—i káº¿t ná»‘i há»‡ thá»‘ng";
      statusEl.className = "err";
    });
}
</script>
